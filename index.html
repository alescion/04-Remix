<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Piece Travel by GM Magnus Carlsen</title>
        <!-- Load d3.js -->
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <style>
            svg {
                border: 2px solid green;
            }
        </style>
    </head>
    <body>
        <div id="vizs">
            <div id="main"></div>
            <div id="pie"></div>
            <script>
                    
                d3.csv("distances.csv").then(function(data) {
                    // data.forEach(function(row) {
                    //     addDistances(row)
                    // })
                    //console.log(distances)
                    loadBars(data)
                });

                d3.csv("chess_distance.csv").then(function(data) {
                    loadPie(calculateWinPercent(data, getColumn("a ♙"), "0-1"))
                });

                // given a label, return the name of a column
                function getColumn(label) {
                    switch(label) {
                        case "a ♙" || "a ♟︎": return "a pawn";
                        case "b ♙" || "b ♟︎": return "b pawn";
                        case "c ♙" || "c ♟︎": return "c pawn";
                        case "d ♙" || "d ♟︎": return "d pawn";
                        case "e ♙" || "e ♟︎": return "e pawn";
                        case "f ♙" || "f ♟︎": return "f pawn";
                        case "g ♙" || "g ♟︎": return "g pawn";
                        case "h ♙" || "h ♟︎": return "h pawn";
                        case "queenside ♖" || "queenside ♜": return "queen-side rook";
                        case "queenside ♘" || "queenside ♞": return "queen-side knight";
                        case "queenside ♗" || "queenside ♝": return "queen-side bishop";
                        case "♕" || "♛": return "queen";
                        case "♔" || "♚": return "king";
                        case "kingside ♗" || "kingside ♝": return "king-side bishop";
                        case "kingside ♘" || "kingside ♞": return "king-side knight";
                        case "kingside ♖" || "kingside ♜": return "king-side rook";
                    }
                }

                // Given a piece, calculate Magnus' win/loss/draw percentage when moving that piece at least 4 squares
                function calculateResultPercent(data, piece, result) {
                    results = 0
                    total = 0
                    // console.log("running")
                    data.forEach(function(row) {
                        total += 1;
                        if (row["Result"] == result && row[piece] >= 4) {
                            results++;
                        }
                    })

                    // console.log(wins)
                    // console.log(total)

                    // var dict = {};

                    // dict["wins"] = wins;
                    // dict["other"] = total - wins;

                    return results/total;
                }

                function getStats() {}

                function loadPie(data) {
                    // console.log(data)

                    // svg = d3.select("#pie")
                    // width = 450
                    // height = 450
                    // radius = Math.min(width, height) / 2,
                    // g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                    // var color = d3.scaleOrdinal(['#4daf4a','#377eb8','#ff7f00','#984ea3','#e41a1c']);

                    // // Generate the pie
                    // var pie = d3.pie();

                    // // Generate the arcs
                    // var arc = d3.arc()
                    //             .innerRadius(0)
                    //             .outerRadius(radius);

                    // //Generate groups
                    // var arcs = g.selectAll("arc")
                    //             .data(pie(data))
                    //             .enter()
                    //             .append("g")
                    //             .attr("class", "arc")

                    // //Draw arc paths
                    // arcs.append("path")
                    //     .attr("fill", function(d, i) {
                    //         return color(i);
                    //     })
                    //     .attr("d", arc);

                    // data = {
                    //     a: 10,
                    //     b: 24,
                    //     c: 48
                    // }

                    // console.log(data)
                    // var WIDTH = 450
                    // var HEIGHT = 450

                    // var svg_donut = d3.select("#pie")
                    //     .append("svg")
                    //     .attr("width", WIDTH)
                    //     .attr("height", HEIGHT)
                    //     .append("g")
                    //     .attr("transform", "translate(" + WIDTH / 2 + "," + HEIGHT / 2 + ")");

                    // var radius = HEIGHT / 2 - 10 // add margin to prevent clipping

                    // var donut = d3.pie()
                    //     .value(function (d) { console.log(d); return d.value; })
                    // var donutData = donut(Object.entries(data))
                    // // console.log(Object.entries(data))
                    // // console.log(donutData[0].data[1])
                    // // console.log(donutData)

                    // var arcMaker = d3.arc()
                    //     .innerRadius(50)
                    //     .outerRadius(radius)
                    
                    // // var newData = { "wins" : donutData[0].data[1], "other": donutData[1].data[1] }

                    // // svg_donut
                    // //     .selectAll('data')
                    // //     .data(donutData)
                    // //     .enter()
                    // //     .append('path')
                    // //     .attr('d', arcMaker)
                    // //     .attr("fill", "green")
                    // //     .attr("stroke", "black")
                    // //     .style("stroke-width", "2px")
                    // //Generate groups
                    // var arcs = svg_donut.selectAll("arc")
                    //     .data(pie(data))
                    //     .enter()
                    //     .append("g")
                    //     .attr("class", "arc")

    // //Draw arc paths
    //                 arcs.append("path")
    //                     .attr("fill", function(d, i) {
    //                         return color(i);
    //                     })
    //                     .attr("d", arc);
                }

                function loadBars(data) {
                    //console.log(data)

                    var margin = {top: 40, right: 20, bottom: 120, left: 160}
                    var width = 640 - margin.left - margin.right
                    var height = 780 - margin.top - margin.bottom

                    var svg = d3.select("#main")
                    .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                        .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
                    
                    // Title
                    svg.append("text")             
                        .attr("transform",
                        "translate(" + (width/2) + " ," + (-1* margin.top/3) + ")")
                        .style("font-size", "24px")
                        .attr("font-weight", "bold")
                        .attr("font-family", "Arial")
                        .style("text-anchor", "middle")
                        .text("Piece Travel by GM Magnus Carlsen");

                    // X axis
                    var x = d3.scaleLinear()
                        .domain([0, 26000])
                        .range([0, width]);
                    svg.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x))
                        .selectAll("text")
                        .attr("transform", "translate(-10,0)rotate(-45)")
                        .style("text-anchor", "end");
                    
                    // text label for X axis
                    svg.append("text")             
                        .attr("transform",
                        "translate(" + (width/2) + " ," + (height + margin.top*1.5) + ")")
                        .style("font-size", "24px")
                        .attr("font-weight", "bold")
                        .attr("font-family", "Arial")
                        .style("text-anchor", "middle")
                        .text("Total Squares Moved");

                    // Y axis
                    var y = d3.scaleBand()
                        .range([0, height])
                        .domain(data.map(function(d) { return d.Name; }))
                        .padding(.2);
                    svg.append("g")
                        .call(d3.axisLeft(y))
                        .selectAll("text")
                        .style("font-size", "20px");
                    
                    // text label for Y axis
                    svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0 - margin.left)
                        .attr("x",0 - (height / 2))
                        .attr("dy", "1em")
                        .style("font-size", "24px")
                        .attr("font-weight", "bold")
                        .attr("font-family", "Arial")
                        .style("text-anchor", "middle")
                        .text("Chess Piece");

                    // Horizontal bars
                    svg.selectAll("mybar")
                        .data(data)
                        .enter()
                        .append("rect")
                        .attr("x", x(0))
                        .attr("y", function(d) { return y(d.Name); })
                        .attr("width", function(d) { return x(d.Distance); })
                        .attr("height", y.bandwidth())
                        .attr('stroke', 'black')
                        .attr("fill", function(d) {
                            if (d.Color == "w") {
                                return "#dedede"
                            } else {
                                return "#616161"
                            }
                        })
                       
                }
                
            </script>
        </div>
        
    </body>
</html>
